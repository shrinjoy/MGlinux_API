<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Metro Deluxe</title>
  <style>
    @keyframes colorChange {
      0% {
        color: rgb(47, 0, 255);
      }

      50% {
        color: rgb(87, 52, 241);
        /* Bright red */
      }

      75% {
        color: rgb(70, 29, 255);
        /* Bright red */
      }

      100% {
        color: rgb(47, 0, 255);
      }
    }
  </style>
  <link rel="stylesheet" href="theme.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
  
  <div id="popup">
   
    <label id="popup_msg">popup</label>
  </div>
  <section id="loginform">
    <label>v1.1</label>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xl-5 col-9 mx-auto">
          <div class="loginWrapper">
            <h1 style="width: max-content; border-bottom: 2px solid #1161ee">
              Metro Deluxe SIGN IN
            </h1>
            <div class="mt-3">
              <label class="inputLabel">ID</label>
              <input placeholder="ENTER ID" id="uname" type="text" required />
              <!-- <label style="text-align: center;">or</label> -->
            </div>
            <div class="mt-3">
              <label class="inputLabel">Username</label>
              <input maxlength="20" placeholder="ENTER USERNAME" id="uID" type="text" required />
              <label class="d-block text-center" style="color: gray">(case sensitive)</label>
            </div>
            <div class="mt-3">
              <label class="inputLabel">Password</label>
              <input placeholder="ENTER PASSWORD" id="pword" type="password" required />
            </div>
            <div class="mt-3">
              <label class="inputLabel mb-3">Please enter the number as you see in the image</label>
              <h1 style="font-weight: bold; text-align: center" id="catchpa">
                123456
              </h1>
              <input style="margin: 0 auto; width: 100%" placeholder="Enter Captcha" id="captchaInput" required />
            </div>
            <div class="mt-3 d-flex align-items-center justify-content-center">
              <input id="keepLoggedIn" name="keepLoggedIn" type="checkbox" />
              <span class="keepSignedIn">Keep me signed in</span>
            </div>
            <button class="loginBtn mt-3" onclick="checklogin()">
              Sign In
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="mc" class="mainContent" style="display: none;">
    <div class="container-fluid px-4" style="border-bottom: 1px solid red">
      <div class="gameWrapper">
        <div class="row headerRow">
          <!-- <div>
              <h1>Metro delux</h1>
            </div>
            <div class="col-2">
              <label>Game Gift Code</label>
              <label id="gameid" style="color: blue">A00</label>
            </div>
            <div class="col-2">
              <label> Game Time </label>
              <label id="timer">0000</label>
            </div> -->
          <!-- <div class="col-2">
              <label> P.No. </label>
              <label id="username" style="color: #ce0b00">123456789</label>
            </div>
            <div class="col-2">
              <label>Balance</label>
              <label id="balance" style="color: #ce0b00"> 00000 </label>
            </div>
            <div class="col-2">
              <label> Time</label> <label id="realtime">00:00:00</label>
            </div> -->
        </div>

        <div class="row gameRow gx-0">
          <div class="col-3">
            <div class="headerRow">
              <div class="col-12 text-center">
                <h1>Metro Deluxe</h1>
              </div>
              <div class="col-6 text-center">
                <label>Game Gift Code</label>
                <label id="gameid" style="color: blue">A00</label>
              </div>
              <div class="col-6 text-center">
                <label> Countdown </label>
                <label id="timer">0000</label>
              </div>
            </div>
            <div id="background" class="mt-2">
              <div class="retardedSpinningShit position-relative">
                <div class="imgWrapper mx-auto">
                  <img src="./public/background.png" />
                </div>
                <div class="imgWrapper2">
                  <img id="card" src="./public/1.jpeg" />
                </div>
              </div>
              <div id="res_sofar_div">
                <table style="
                      height: 100%;
                      width: 100%;
                      overflow-y: scroll;
                      display: block;
                      /* background-color: red; */
                    " id="res_sofar_table"></table>
              </div>
            </div>
          </div>

          <div class="col-9">
            <div class="headerRow">
              <div class="col-3">
                <label> P.No. </label>
                <label id="username" style="color: #ce0b00">123456789</label>
              </div>
              <div class="col-3 text-end">
                <!-- <label>Balance</label> -->
                <label id="balance" style="color: #ce0b00"> 00000 </label>
              </div>
              <div class="col-3 text-center">
                <label> Time :</label>
                <label id="realtime">&nbsp;&nbsp;00:00:00</label>
              </div>
              <div class="col-3 text-end">
                <button class="text-white border-0" style="background-color: red;font-size:25px;"
                  onclick="togglePopup(4)">
                  Change Password
                </button>
              </div>
            </div>
            <div id="buttonholder" class="mt-2">
              <table id="betinputpanel" class="h-100"></table>
            </div>
          </div>
        </div>

        <div class="buttonsRow" style="margin-left: 10px">
          <div class="btnItem" style="width: 200px">
            <button class="gamebutton" id="buybuttonXD" onclick="buyticket()" style="background-color: #eac697">
              F6-Buy
            </button>
          </div>
          <div class="btnItem" style="width: 180px">
            <button class="gamebutton" onclick="togglePopup(1)">
              Advance Draw(F8)
            </button>
          </div>
          <div class="btnItem">
            <button class="gamebutton" onclick="clearallinputs()">
              Clear(ESC)
            </button>
          </div>
          <div class="btnItem">
            <button class="gamebutton" onclick="cancel_bet()">
              Cancel(F9)
            </button>
          </div>
          <div class="btnItem">
            <button class="gamebutton" onclick="togglePopup(2)">
              Report(F4)
            </button>
          </div>
          <div class="btnItem">
            <button class="gamebutton" onclick="togglePopup(3)">
              Stone(F7)
            </button>
          </div>
          <div class="btnItem" style="width: 70px">
            <button class="gamebutton" style="background-color: #eac697" onclick="location.reload()">
              Exit
            </button>
          </div>
          <div class="btnItem" style="width: max-content">
            <label id="totqt_val">Total Qty: <span>0</span></label>
          </div>
          <div class="btnItem" style="width: max-content">
            <label id="totamt_val">Total Amnt: <span>0</span></label>
          </div>
        </div>
        <!-- <div id="lowerpanel">
            <table style="width: 100%" id="lowerpaneltable">
              <tr>
                <td>
                  <button
                    class="gamebutton"
                    style="background-color: #e8c595"
                    onclick="buyticket()"
                  >
                    F5-Buy
                  </button>
                </td>
                <td>
                  <button
                    class="gamebutton"
                    style="background-color: #00ffff"
                    onclick="showadvancebet()"
                  >
                    Advance Draw(F6)
                  </button>
                </td>
                <td>
                  <button
                    class="gamebutton"
                    style="background-color: #00ffff"
                    onclick="clearallinputs()"
                  >
                    Clear(ESC)
                  </button>
                </td>
                <td>
                  <button
                    class="gamebutton"
                    style="background-color: #00ffff"
                    onclick="cancelbet()"
                  >
                    Cancel(F9)
                  </button>
                </td>
                <td>
                  <button class="gamebutton" style="background-color: #00ffff">
                    Report(F4)
                  </button>
                </td>
                <td>
                  <button
                    class="gamebutton"
                    style="background-color: #00ffff"
                    onclick="showstones()"
                  >
                    Stone(F7)
                  </button>
                </td>
                <td>
                  <button class="gamebutton" style="background-color: #e8c595">
                    Exit
                  </button>
                </td>
                <td>
                  <label id="totqt_val">total Qnt:0</label>
                </td>
                <td>
                  <label id="totamt_val">total Amnt:0</label>
                </td>
              </tr>
            </table>
          </div> -->

        <div id="stone_show" data-id="3">
          <button onclick="togglePopup(3)" style="position: absolute; right: 0; top: 0">
            X
          </button>
          <div style="
                background-color: red;
                padding: 25px 0;
                margin-bottom: 30px;
              " id="stone_control_box">
            <label class="text-white">Select Date</label>
            <input id="date" type="date" />
            <button onclick="showresultbydate()" style="border-radius: 5px; background-color: #fff">
              Show Stone
            </button>
          </div>
          <table style="
                overflow-y: scroll;
                height: 95%;
                width: 100%;
                overflow-x: visible;
                display: block;
              " id="stones_table"></table>
        </div>
        <div id="advancebet_show" data-id="1">
          <div style="
                background-color: brown;
                width: 100%;
                height: auto;
                text-align: center;
                color: white;
                font-weight: bolder;
                font-size: larger;
                padding: 10px 0;
              ">
            Advance Draw
          </div>
          <table id="advance_bet_table"></table>
          <div style="
                background-color: brown;
                width: 100%;
                height: auto;
                text-align: center;
                color: white;
                font-weight: bolder;
                font-size: larger;
                padding: 10px 0;
              ">
            <button onclick="togglePopup(1)">OK</button>
            <button onclick="togglePopup(1)">Cancel</button>
          </div>
        </div>
        <div class="changePassword" id="change_password_4" data-id="4">
          <div style="
                background-color: brown;
                width: 100%;
                height: auto;
                text-align: left;
                color: white;
                font-weight: bolder;
                font-size: larger;
                padding: 5px 0;
                position: relative;
              ">
            <label class="text-white">Change Password</label>
            <div style="position: absolute; right: 0; top: 0">
              <button onclick="togglePopup(4)">X</button>
            </div>
          </div>
          <div>
            <form class="p-3">
              <div class="p-2">
                <div class="border-top row p-2">
                  <div class="col-6">
                    <label for="username" style="font-weight: 700; font-size: 30px"><span
                        class="text-danger">*</span>Enter Current
                      Password:-</label>
                  </div>
                  <div class="col-6">
                    <input type="text" class="gameInputText" name="username" id="cpusername" />
                  </div>
                </div>
                <div class="border-top row p-2">
                  <div class="col-6">
                    <label for="password" style="font-weight: 700; font-size: 30px"><span
                        class="text-danger">*</span>Enter New
                      Password:-</label>
                  </div>
                  <div class="col-6">
                    <input  class="gameInputText" name="password" id="password" />
                  </div>
                </div>
                <div class="border-top border-bottom row p-2">
                  <div class="col-6">
                    <label for="newpassword" style="font-weight: 700; font-size: 30px"><span
                        class="text-danger">*</span>Re-Enter
                      Password:-</label>
                  </div>
                  <div class="col-6">
                    <input  class="gameInputText" name="newpassword" id="newpassword" />
                  </div>
                </div>
                <div class="text-center pt-2">
                  <button onclick="changePassword(event)">Submit</button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="reportPanel" data-id="2">
          <div style="
                background-color: brown;
                width: 100%;
                height: 35px;
                text-align: left;
                color: white;
                font-weight: bolder;
                font-size: larger;
                padding: 5px 0;
                position: relative;
              ">
            <div style="position: absolute; right: 0; top: 0">
              <button onclick="togglePopup(2)">X</button>
            </div>
          </div>
          <div class="p-2">
            <ul class="nav mb-3" id="pills-tab" role="tablist">
              <li>
                <a id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab"
                  aria-controls="pills-home" aria-selected="true" style="color: #0d6efd">Play Details</a>
              </li>
              <li>
                <a id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab"
                  aria-controls="pills-profile" aria-selected="false" style="color: #0d6efd">Datewise Summary</a>
              </li>
              <li>
                <a id="pills-sales-tab" data-bs-toggle="pill" data-bs-target="#pills-sales" type="button" role="tab"
                  aria-controls="pills-sales" aria-selected="false" style="color: #0d6efd">Sales report</a>
              </li>
            </ul>
            <div class="tab-content" id="pills-tabContent" style="border: 1px solid black">
              <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                <div class="d-flex w-100">
                  <div class="col-2">
                    <input type="date" name="" id="reportDate" />
                  </div>
                  <div class="col-2">
                    <select name="" id="buttonSelectorReport" style="width: 50px">
                      <option value="all">All</option>
                    </select>
                  </div>
                  <div class="col-2">
                    <button id="reportSubmit">Get Report</button>
                  </div>
                </div>
                <table class="playDetails w-100" id="playDetailsTable">
                  <tr>
                    <th>Sr. No</th>
                    <th>Gift Event Code</th>
                    <th>Qty</th>
                    <th>Points</th>
                    <th>Request ID</th>
                    <th>Date Time</th>
                    <th>Gift Points</th>
                    <th>Stone</th>
                    <th>Status</th>
                    <th>View</th>
                  </tr>
                </table>
                <div class="total">
                  <table style="background-color: brown">
                    <tr>
                      <td width="89.2px" style="border: 1px solid #fff"></td>
                      <td width="203.6px" class="text-center text-white fw-bold" style="border: 1px solid #fff">
                        Total
                      </td>
                      <td width="60.2px" class="text-center text-white fw-bold" style="border: 1px solid #fff" \
                        id="totalQty"></td>
                      <td width="91.4px" class="text-center text-white fw-bold" style="border: 1px solid #fff"
                        id="totalPoints"></td>
                      <td width="146.7px" style="border: 1px solid #fff"></td>
                      <td width="139.4px" style="border: 1px solid #fff"></td>
                      <td width="143.7px" class="text-center text-white fw-bold" style="border: 1px solid #fff"
                        id="totalGiftPoints"></td>
                      <td width="85.4px" style="border: 1px solid #fff"></td>
                      <td width="91px" style="border: 1px solid #fff"></td>
                      <td width="75px" style="border: 1px solid #fff"></td>
                    </tr>
                  </table>
                </div>
              </div>
              <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                <div class="d-flex w-100">
                  <div class="col-2">
                    <input type="date" name="" id="startDate" />
                  </div>
                  <div class="col-2">
                    <input type="date" name="" id="endDate" />
                  </div>
                  <div class="col-2">
                    <button id="summarySubmit">Get Summary</button>
                  </div>
                </div>
                <table class="playDetails w-100" id="datewiseSummaryTable">
                  <tr>
                    <th>DATE</th>
                    <th>PURCHASE POINT</th>
                    <th>PWT POINT</th>
                    <th>NET POINT</th>
                  </tr>
                </table>
              </div>
              <div class="tab-pane fade" id="pills-sales" role="tabpanel" aria-labelledby="pills-sales-tab">
                <div class="d-flex w-100">
                  <div class="col-2">
                    <input type="date" name="" id="startDate_sales" />
                  </div>
                  <div class="col-2">
                    <input type="date" name="" id="endDate_sales" />
                  </div>
                  <div class="col-2">
                    <button id="summarySubmit_sales">Get Sales Report</button>
                  </div>
                </div>
                <table class="playDetails w-100" id="salesreporttable">
                  <tr>
                    <th>Play Point</th>
                    <th>Win Point</th>
                    <th>End Point</th>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="barcodePopup">
          <div style="position: absolute; right: 0; top: 0">
            <button onclick="closeBarCodePopup()">X</button>
          </div>
          <div class="content">
            <p>For Amusement Only</p>
            <p>D.D: <span id="dateTimePopup"></span></p>
            <div class="d-flex justify-content-center">
              <div>
                <p>
                  D.T: <span id="gameIdPopup" class="elementToClear"></span>
                </p>
              </div>
              <div class="ms-2">
                <p>
                  Pos ID: <span id="posIdPopup" class="elementToClear"></span>
                </p>
              </div>
            </div>
            <div class="ticketGroup"></div>
            <div class="d-flex justify-content-center">
              <div>
                <p>Qty. <span id="qtyPopup" class="elementToClear"></span></p>
              </div>
              <div class="ms-2">
                <p>
                  Total Pts.
                  <span id="totalPtsPopup" class="elementToClear"></span>
                </p>
              </div>
            </div>
            <div class="d-flex justify-content-center">
              <div>
                <p>G.id:</p>
              </div>
              <div>
                <p>
                  <span class="ms-2" id="barCodePopupValue" class="elementToClear"></span>
                </p>
              </div>
            </div>
            <div class="barcodeImage">
              <svg id="barcodeEle" class="elementToClear"></svg>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <div style="height: 101vh;visibility: hidden;"></div> -->
  </section>
</body>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.createjs.com/1.0.0/tweenjs.min.js"></script>
<script src="cardanimation.js"></script>

<script src="frontendfunc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
<script>

  var canplacebet=true;
  var betinputpanel = document.getElementById("betinputpanel");
var gameidtext = document.getElementById("gameid");
var gametimertext = document.getElementById("timer");
var realtimertext = document.getElementById("realtime");
var username = "";
var password = "";
var bettingID = [];
var time = 99999;
var gameid = "X00";
var userbalance = 0;
var userid = "nouser";
var alltop = 0;
var allbottom = 0; //
var betinputs;
var totalbet;
var lastbetbarcode = "";

// document.getElementById("mc").style = "display:none";

for (y = -1; y < 10; y++) {
  var betdata = [];
  var tr = document.createElement("tr");
  for (x = -1; x < 10; x++) {
    var td = document.createElement("td");
    td.setAttribute("class", "td_betinp");
    var namelabel = document.createElement("label");
    namelabel.innerHTML = `MD${y}${x}`;
    var br = document.createElement("br");
    // br.setAttribute("class", "spacer");

    var inp = document.createElement("input");
    inp.setAttribute("class", "betinput");
    inp.setAttribute("id", `NR${y}${x}`);
    inp.setAttribute("min", "0");
    inp.setAttribute("type", "number");
    inp.addEventListener("input", function () {
      inputfieldupdate();
    });
    inp.addEventListener("change", function () {
      inputfieldupdate();
    });
    if (x === -1 || y === -1) {
      //blocks are all bet inputs
      namelabel.innerHTML = "&nbsp";
      td.append(namelabel);
      inp.setAttribute("data-oldall", 0);
      if (x == -1) {
        inp.setAttribute("id", `B${y}`);
      }
      if (y == -1) {
        inp.setAttribute("id", `T${x}`);
      }
      inp.addEventListener("input", function () {
        allfieldbetplace(this.id);
      });
    } else {
      td.append(namelabel);
    }
    td.append(br);

    if (x === -1 && y === -1) {
      td.append(namelabel);
      //this is a block field for header ;c
      namelabel.innerHTML = "Block";
    } else {
      td.append(inp);
    }
    tr.append(td);
  }
  betinputpanel.append(tr);
}

try {
  var d = getJSONCookie("userdata");
  document.getElementById("uname").value = d.user_ID;
  document.getElementById("uID").value = d.user_name;

}
catch {

}


function checklogin() {
  // /canlogin

  // console.log(
  //   document.getElementById("uname").value.toString(),
  //   document.getElementById("pword").value.toString(),
  // );
  var name = document.getElementById("uID").value.toString();
  var pass = document.getElementById("pword").value.toString();
  var captcha = document.getElementById('catchpa').textContent;
  var captchaInput = document.getElementById('captchaInput').value;

  if (captchaInput === captcha) {
    axios({
      method: "post",
      url: "http://77.37.47.190:3059/canlogin",
      data: {
        userid: document.getElementById("uname").value.toString(),
        username: name,
        password: pass,
      },
    })
      .then(function (res) {
        if ((res.data.status = "200")) {
          document.getElementById("loginform").style = "display:none";

          document.getElementsByClassName("mainContent").style = "display:block";
          document.getElementById("mc").style = "display:block";

          mobileUIFix();

          getuserdata(name, pass);
          setInterval(function () {
            getuserdata(username, password);
          }, 1000);

          username = name;
          password = pass;
          if(username!==password)
          {
             
              document.getElementById('change_password_4').style.display = "none"
          }
          if (document.getElementById("keepLoggedIn").checked) {
            var jdata = { user_name: name, user_ID: document.getElementById("uname").value.toString() }
            setJSONCookie("userdata", jdata, 365);
          }
          
        }
      })
      .catch((err) => {
        console.log(err);
        showpopup("Wrong username or password", "red");
      });
  } else {
    showpopup("Wrong CAPTCHA", "red");
  }

}



function setJSONCookie(name, data, daysToExpire) {
  const jsonData = JSON.stringify(data);
  let expires = "";
  if (daysToExpire) {
    const date = new Date();
    date.setTime(date.getTime() + (daysToExpire * 24 * 60 * 60 * 1000));
    expires = "; expires=" + date.toUTCString();
  }
  document.cookie = name + "=" + encodeURIComponent(jsonData) + expires + "; path=/";
}
function getJSONCookie(name) {
  const cookies = document.cookie.split(';');
  for (let i = 0; i < cookies.length; i++) {
    const cookie = cookies[i].trim();
    if (cookie.startsWith(name + "=")) {
      const jsonStr = decodeURIComponent(cookie.substring(name.length + 1));
      return JSON.parse(jsonStr);
    }
  }
  return null; // Cookie not found
}






function allfieldbetplace(thisid) {
  let inputValue = parseInt(document.getElementById(thisid).value);

  //data-oldall

  if (isNaN(inputValue) || inputValue < 0) {
    document.getElementById(thisid).value = ""; // Clear the input
  }

  var betdata = thisid;
  if (betdata[0] === "T") {
    for (x = 0; x < 10; x++) {
      var idinp = "";
      idinp = `NR${x}${thisid[1]}`;
      document.getElementById(idinp).value =
        (parseInt(document.getElementById(thisid).value) || 0) +
        (parseInt(document.getElementById(idinp).value) || 0);
      document.getElementById(idinp).value -= parseInt(
        document.getElementById(thisid).getAttribute("data-oldall") || 0
      );
    }
    //("top");
  }
  if (betdata[0] == "B") {
    //("bottom");
    limit = 0;

    limit = parseInt(betdata[1]) + 1;

    //(`${parseInt(betdata[1])*10}${(limit*10)}`)
    for (x = parseInt(betdata[1]) * 10; x < limit * 10; x++) {
      var idinp = "";
      if (x < 10) {
        idinp = `NR0${x}`;
      } else {
        idinp = `NR${x}`;
      }

      document.getElementById(idinp).value =
        (parseInt(document.getElementById(thisid).value) || 0) +
        (parseInt(document.getElementById(idinp).value) || 0);
      document.getElementById(idinp).value -= parseInt(
        document.getElementById(thisid).getAttribute("data-oldall") || 0
      );
    }
  }

  inputfieldupdate();

  document
    .getElementById(thisid)
    .setAttribute("data-oldall", document.getElementById(thisid).value);

  //(betdata[0],betdata[1]);
}
function inputfieldupdate() {
  totalbet = 0;

  for (y = 0; y < 10; y++) {
    for (x = 0; x < 10; x++) {
      // Get the input element

      let inputElement = document.getElementById(`NR${y}${x}`);

      // Get the value and parse it to an integer, or use 0 if not a valid number
      let inputValue = parseInt(inputElement.value) || 0;

      if (isNaN(inputValue) || inputValue <= 0) {
        inputElement.value = ""; // Clear the input
      }

      inputElement.setAttribute("data-old", inputElement.value);
      // Add the valid number to totalbet
      totalbet += inputValue;
    }
  }

  document.getElementById("totqt_val").innerHTML =
    "Total Qnt: <span>" + totalbet + "</span>";
  document.getElementById("totamt_val").innerHTML =
    "Total Amnt: <span>" + totalbet + "</span>";
}
function buyticket() {
  

  if(time>13)
  {

  if (totalbet > 0) {
    var datax = [];
    for (y = 0; y < 10; y++) {
      for (x = 0; x < 10; x++) {
        var id = `${y}${x}`;
        if(document.getElementById("NR" + id).value>0)
        {
        datax.push(
          `${y}${x}Q${parseInt(document.getElementById("NR" + id).value) || 0}`
        );
      }
      }
    }
console.log(datax);
    data = {
      username: username,
      password: password,
      tickets: datax.toString(),
      totalbet: totalbet,
      gameid: gameid.toString(),
    };
    //(data);
    var tempids = bettingID;

    if (bettingID.length > 1) {

      tempids.shift();
    }
    else if (bettingID.length == 1) {
      
      tempids = [];
     // gettimeandgameid_withoutreset();
      tempids.push(gameid);
    }

    console.log(tempids);

    tempids.forEach((e) => {
     // gettimeandgameid_withoutreset();

      if( time > 13)
    {

      axios({
        method: "post",
        url: "http://77.37.47.190:3059/placebet",
        data: {
          username: username,
          password: password,
          tickets: datax.toString(),
          totalbet: totalbet,
          gameid: e.toString(),
        },
      })
        .then(function (res) {
          //("placed bet in id:"+e.toString());
          //(res["data"]["barcode"]);
          
          lastbetbarcode = res["data"]["barcode"];

          console.log("got user data");


          showpopup("Transaction Succesfull", "green"); //popup_function




        
          totalbet = 0;
          
        })
        .catch(function (err) {


          alert(err);
          showpopup("Transaction Failed", "red"); //popup_function


          getuserdata(username, password);

        });
      }
      else
      {
        showpopup("out of time ", "red"); //popup_function

      }
    });
    var checkboxes = document.querySelectorAll('input[type="checkbox"]');
    datax = null;
    // Loop through each checkbox and uncheck it
    checkboxes.forEach(function (checkbox) {
      checkbox.checked = false;
      getuserdata(username, password);
    });
    var currentid = bettingID[0];
    bettingID = [];
    bettingID.push(currentid);
    clearallinputs();
  } else {
    try {
      showpopup("Transaction Failed", "red"); //popup_function
    }
    catch {

    }
    resetbetdata();
  }
  loadallpossiblefuturebets();
}
}

  /**/


function resetbetdata() {
  var checkboxes = document.querySelectorAll('input[type="checkbox"]');

  // Loop through each checkbox and uncheck it
  checkboxes.forEach(function (checkbox) {
    checkbox.checked = false;
    getuserdata(username, password);
  });
  var currentid = bettingID[0];
  bettingID = [];
  bettingID.push(currentid);
  clearallinputs();
}
async function loadallpossiblefuturebets() {
  // console.clear();
  // console.log("loading future bets");

  var advancebet = document.getElementById("advancebet_show");
  var advancebettable = document.getElementById("advance_bet_table");
  var firstid;
  while (advancebettable.rows.length > 0) {
    advancebettable.deleteRow(0);
  }
  while (advancebettable.rows.length > 0) {
    advancebettable.deleteRow(1);
  }

  startloading = false;
  await axios({
    method: "get",
    url: "http://77.37.47.190:3059/getallresult",
  })
    .then(function (res) {
      var parsedData = res.data;
      var count = 0;
      var tablerow = document.createElement("tr");

      var firstbet = 0;
      for (var key in parsedData) {
        if (parsedData.hasOwnProperty(key)) {
          if (key.toString() === gameid) {
            //("found same id");
            startloading = true;
          } else {
            if (startloading === true) {
              if (parsedData[key].toString().trim().length === 0) {
                count += 1;
                if (count == 10) {
                  advancebettable.append(tablerow);
                  count = 1;
                  tablerow = document.createElement("tr");
                }
                var td = document.createElement("td");
                // td.innerHTML = key;
                var tdText = document.createElement("label"); // remove if necessary
                tdText.innerHTML = key; // remove if necessary
                td.append(tdText); // remove if necessary
                var inp = document.createElement("input");
                inp.setAttribute("type", "checkbox");
                inp.setAttribute("id", `${key}`);
                // console.log(`${key}`)
                // Add event listener to each checkbox
                inp.addEventListener("change", function () {
                  addidtolistforadvancebet(this.id);
                });
                td.append(inp);
                tablerow.append(td);
              }
            }
          }
        }
      }
      advancebettable.append(tablerow);
    })
    .catch((err) => {
      // alert("failed to load the data try to load again");
      loadallpossiblefuturebets();
    });
}

showstones_bool = false;

function showstones() {
  var advancebet = document.getElementById("stone_show");

  if (showadvancebet_bool === true) {
    advancebet.style = "display:none";
    showadvancebet_bool = false;
  } else if (showadvancebet_bool === false) {
    advancebet.style = "display:block";

    showadvancebet_bool = true;
  }
}

// /getallresultbydate
function showresultbydate() {
  var table = document.getElementById("stones_table");
  if (table) {
    var rowCount = table.rows.length;

    for (var i = rowCount - 1; i > 0; i--) {
      table.deleteRow(i);
    }
  }
  if (table) {
    var rowCount = table.rows.length;

    for (var i = rowCount - 1; i > 0; i--) {
      table.deleteRow(i);
    }
  }
  var tablerow = document.createElement("tr");
  // Clear existing rows in the table
  table.innerHTML = "";

  axios({
    method: "post",
    url: "http://77.37.47.190:3059/getallresultbydate",
    data: {
      date: document.getElementById("date").value.toString(),
    },
  })
    .then(function (res) {
      // Assuming res.data is already a parsed JSON object
      var parsedData = res.data;
      var count = 0;
      var tr;
      //(res);
      for (var key in parsedData) {
        if (parsedData.hasOwnProperty(key)) {
          var gameidname = document.createElement("td");
          // var gameresultname = document.createElement("td");
          var textWrapper = document.createElement("div");
          var textWrapper2 = document.createElement("div");
          // gameidname.innerHTML = key;
          //rowspan="1" colspan="2"
          gameidname.setAttribute("class", "oldres");
          gameidname.append(textWrapper);
          textWrapper.innerHTML = key;
          gameidname.append(textWrapper2);
          textWrapper2.innerHTML = "MD" + parsedData[key];
          textWrapper2.setAttribute("id", "oldresid");
          //gameidname.setAttribute("rowspan","1")
          // gameresultname.innerHTML = "NR" + parsedData[key];
          // gameresultname.setAttribute("class", "oldres");
          // gameresultname.setAttribute("id", "oldresid");
          // gameidname.append(gameresultname);

          tablerow.append(gameidname);
          count += 1;
          if (count == 10) {
            table.append(tablerow);
            count = 0;
            tablerow = document.createElement("tr");
            tablerow.setAttribute("class", "tablerow");
          }
        }
      }
      table.append(tablerow);
      // Move the return statement outside the loop
      return res.data;
    })
    .catch((err) => {
      //("Failed to fetch result data: " + err);
    });
}

showadvancebet_bool = false;
function showadvancebet() {
  var advancebet = document.getElementById("advancebet_show");

  if (showadvancebet_bool === true) {
    advancebet.style = "display:none";
    showadvancebet_bool = false;
  } else if (showadvancebet_bool === false) {
    advancebet.style = "display:block";

    showadvancebet_bool = true;
  }
}
function addidtolistforadvancebet(checkboxId) {
  // Print a message with the checkbox ID

  ////(`Checkbox with ID '${checkboxId}' is ${document.getElementById(checkboxId).checked ? 'checked' : 'unchecked'}`);
  if (document.getElementById(checkboxId).checked === true) {
    bettingID.push(checkboxId);
    //(bettingID);
  } else if (document.getElementById(checkboxId).checked === false) {
    for (k = 0; k < bettingID.length; k++) {
      if (bettingID[k] === checkboxId) {
        bettingID.splice(k, 1);
      }
    }
    //(bettingID);
  }
}
function getAllResultsSoFar() {


  axios({
    method: "get",
    url: "http://77.37.47.190:3059/getallresultsofar",
  })
    .then(function (res) {
      var table = document.getElementById("res_sofar_table");
      if (table) {
        var rowCount = table.rows.length;

        for (var i = rowCount - 1; i > 0; i--) {
          table.deleteRow(i);
        }
      }
      if (table) {
        var rowCount = table.rows.length;

        for (var i = rowCount - 1; i > 0; i--) {
          table.deleteRow(i);
        }
      }
      var tablerow = document.createElement("tr");
      // Clear existing rows in the table
      table.innerHTML = "";
      // Assuming res.data is already a parsed JSON object
      var parsedData = res.data;
      var count = 0;
      var tr;
      //(res);
      for (var key in parsedData) {
        if (parsedData.hasOwnProperty(key)) {
          var gameidname = document.createElement("td");
          var gameresultname = document.createElement("td");
          var randoLab = document.createElement("label");
          randoLab.innerHTML = key;
          gameidname.append(randoLab);
          //rowspan="1" colspan="2"
          gameidname.setAttribute("class", "oldres");
          //gameidname.setAttribute("rowspan","1")
          gameresultname.innerHTML = "MD" + parsedData[key];
          gameresultname.setAttribute("class", "oldres");
          gameresultname.setAttribute("id", "oldresid");
          gameidname.append(gameresultname);

          tablerow.append(gameidname);
          count += 1;
          if (count == 3) {
            table.append(tablerow);
            count = 0;
            tablerow = document.createElement("tr");
            tablerow.setAttribute("class", "tablerow");
          }
        }
      }
      table.append(tablerow);

      // Move the return statement outside the loop
      return res.data;
    })
    .catch((err) => {
      //("Failed to fetch result data: " + err);
    });
    cancelbet=true;
}
getAllResultsSoFar();
function gettimeandgameid() {
  axios({
    method: "get",
    url: "http://77.37.47.190:3059/timeleft",
  }).then(function (res) {
    gameid = res["data"]["gameid"];
    
    time = res["data"]["time"];
    
    bettingID = [];
    bettingID = [gameid.toString()];

    // //(bettingID);
  });
}
function gettimeandgameid_withoutreset() {
  axios({
    method: "get",
    url: "http://77.37.47.190:3059/timeleft",
  }).then(function (res) {
    gameid = res["data"]["gameid"];
    
    time = res["data"]["time"];
    time = time - 12;
   

    // //(bettingID);
  });
}
function getuserdata(usernamex, passwordx) {
  axios({
    method: "post",
    url: "http://77.37.47.190:3059/getalluserdata",
    data: {
      username: usernamex,
      password: passwordx,
    },
  })
    .then(function (res) {
      userid = res["data"]["username"];
      username = userid;
      password = res["data"]["password"];
      userbalance = res["data"]["balance"];
      document.getElementById("balance").innerHTML = userbalance;
      document.getElementById("username").innerHTML = res["data"]["userid"];
      // console.log("usernamepassdata fetched XDXD");
    })
    .catch((err) => {
      //alert(err);
    });
}

gettimeandgameid();


setInterval(() => {
  if(time<12)
  {
    canplacebet=false;

    var advancebettable = document.getElementById("advance_bet_table");
    while (advancebettable.rows.length > 0) {
      advancebettable.deleteRow(0);
    }
    while (advancebettable.rows.length > 0) {
      advancebettable.deleteRow(1);
    }
    bettingID = [];
    datax=null;
    document.getElementById("advancebet_show").style = "display:none";
  }
  else
  {
    canplacebet=true;
  }
}, 1);



function timerupdate() {
  if(username===password)
          {
           document.getElementById('change_password_4').style.display = "block";
         }
  time -= 1;
  if (time < 1) {
    // console.clear();
    getAllResultsSoFar();

    gettimeandgameid();

    loadallpossiblefuturebets();
    
  }
  if (time < 11) {
    cancelbet =false;
    gametimertext.style = "color:red";
  } else {
    
    
    gametimertext.style = "color:black";
  }
  gametimertext.innerHTML = formatSecondsToTime(time);
  gameidtext.innerHTML = gameid;
  realtimertext.innerHTML = getCurrentTime();
}
function getCurrentTime() {
  const currentDate = new Date();
  const hours = currentDate.getHours().toString().padStart(2, "0");
  const minutes = currentDate.getMinutes().toString().padStart(2, "0");
  const seconds = currentDate.getSeconds().toString().padStart(2, "0");

  const currentTime = `${hours}:${minutes}:${seconds}`;
  return currentTime;
}
function formatSecondsToTime(seconds) {
  if (seconds < 0) {
    seconds = 0;
  }
  const date = new Date(seconds * 1000); // Convert seconds to milliseconds
  const hours = date.getUTCHours();
  const minutes = date.getUTCMinutes();
  const secondsFormatted = date.getUTCSeconds();

  const formattedTime = `${hours.toString().padStart(2, "0")}:${minutes
    .toString()
    .padStart(2, "0")}:${secondsFormatted.toString().padStart(2, "0")}`;

  return formattedTime;
}
function clearallinputs() {
  var inputnumberbox = document.querySelectorAll('input[type="number"]');

  inputnumberbox.forEach((e) => {
    e.value = null;
    e.setAttribute("data-oldall", 0);
  });
  inputfieldupdate();
}
function cancel_bet() {
  // /cancelbybarcode
  axios({
    method: "post",
    url: "http://77.37.47.190:3059/cancelbybarcode",
    data: {
      barcode: lastbetbarcode,
    },
  })
    .then(function (res) {
      getuserdata(username, password);
      showpopup("Canceled ticket", "green"); //popup_function
    })
    .catch((err) => {
      showpopup("No tickets to cancel", "red"); //popup_function

      getuserdata(username, password);
    });
  lastbetbarcode = "";
}
setInterval(timerupdate, 1000);

function mobileUIFix() {
  x = window.matchMedia("(max-width: 991px)");
  if (x.matches) {
    // This sets the Required Meta Tag
    var viewportMetaTag = document.querySelector('meta[name="viewport"]');
    if (viewportMetaTag) {
      viewportMetaTag.setAttribute(
        "content",
        "width=device-width, initial-scale=0.1"
      );
    }
    // This sets the Required style for '#buttonholder'
    // var buttonHolder = document.getElementById('buttonholder');
    // buttonHolder.style.width = 'max-content';

    // This sets the Required style for '#res_sofar_div'
    var resSofarDiv = document.getElementById("res_sofar_div");
    resSofarDiv.style.width = "95%";
    resSofarDiv.style.margin = "auto";

    // This sets the Required style for '.betinput'
    // var betInput = document.querySelectorAll('.betinput');
    // betInput.forEach(element => {
    //   element.style.width= '75%';
    // });

    // This sets the Required style for '.td_betinp'
    // var tdBetInp = document.querySelectorAll('.td_betinp');
    // tdBetInp.forEach(element => {
    //   element.style.maxWidth= '75px';
    // });
  }
}

function togglePopup(e) {

  if(e===1)
  {
    loadallpossiblefuturebets();
  }
  


  var wrapper = document.querySelector(`[data-id='${e}']`);
  var wrapperStyles = getComputedStyle(wrapper);

  if (wrapperStyles.display === "none") {
    wrapper.style.display = "block";
  } else {
    wrapper.style.display = "none";
  }
}

async function showpopup(popuptext, popupcolor) {
  try {
    var popup = document.getElementById("popup");

    document.getElementById("popup_msg").innerHTML = popuptext;
    popup.style = `background-color:${popupcolor}`;

    popup.setAttribute("id", "popup_notif_show");
    await new Promise((resolve) => setTimeout(resolve, 700));

    popup.setAttribute("id", "popup_notif_slide");
    await new Promise((resolve) => setTimeout(resolve, 500));
    popup.setAttribute("id", "popup");
  }
  catch {

  }
}

function changePassword(event) {
  event.preventDefault();
  var data_username = username;
  var currentpass = document.getElementById("cpusername").value.toString();
  var data_currentPassword = document
    .getElementById("password")
    .value.toString();
  var data_newPassword = document
    .getElementById("newpassword")
    .value.toString();
  console.log(`${data_username} ${data_currentPassword} ${data_newPassword}`);
  if(document
    .getElementById("newpassword")
    .value===document
    .getElementById("password")
    .value){
  axios({
    method: "post",
    url: "http://77.37.47.190:3059/changepassword",
    data: {
      username: data_username,
      password: currentpass,
      newpassword: data_newPassword,
    },
  })
    .then(function (res) {
      console.log(res);
      showpopup("Password Changed Successfully", "green");
      location.reload();
    })
    .catch((error) => {
      console.log(error);
      showpopup("Please Try Again", "red");
    });
  }
  else
  {
    showpopup("passwords dont match ","red");
  }
}
loadallpossiblefuturebets();

function getReportFromDate() {
  var table = document.getElementById("datewiseSummaryTable");
  var startDate = document.getElementById("startDate");
  var endDate = document.getElementById("endDate");
  var submit = document.getElementById("summarySubmit");

  submit.addEventListener("click", function () {
    var startDateValue = startDate.value;
    var endDateValue = endDate.value;
    // console.log("startDate", startDateValue, "endDate", endDateValue);

    if (table) {
      var rowCount = table.rows.length;

      for (var i = rowCount - 1; i > 0; i--) {
        table.deleteRow(i);
      }
    }
    if (table) {
      var rowCount = table.rows.length;

      for (var i = rowCount - 1; i > 0; i--) {
        table.deleteRow(i);
      }
    }

    axios
      .post("http://77.37.47.190:3059/getreportfromdatetodate", {
        username: username,
        start_date: startDateValue,
        end_date: endDateValue,
      })
      .then(function (response) {
        var responseData = response.data.flat();
        responseData.forEach(function (item) {
          var tr = document.createElement("tr");

          var dateCell = document.createElement("td");
          var dateTextNode = document.createTextNode(item.date);
          var date = new Date(item.date);
          var formattedDate = date.toLocaleDateString();
          dateTextNode.textContent = formattedDate;
          dateCell.appendChild(dateTextNode);

          var purchasePointCell = document.createElement("td");
          var purchasePointTextNode = document.createTextNode(
            item.purchasepoint
          );
          purchasePointCell.appendChild(purchasePointTextNode);

          var pwtpointCell = document.createElement("td");
          var pwtpointTextNode = document.createTextNode(item.pwtpoint);
          pwtpointCell.appendChild(pwtpointTextNode);

          var netpointCell = document.createElement("td");
          var netpointTextNode = document.createTextNode(item.netpoint);
          netpointCell.appendChild(netpointTextNode);

          tr.appendChild(dateCell);
          tr.appendChild(purchasePointCell);
          tr.appendChild(pwtpointCell);
          tr.appendChild(netpointCell);

          table.appendChild(tr);
        });
        console.log("Response:", response.data);
      })
      .catch(function (error) {
        console.error("Error:", error);
      });
  });
}

function getSalesreport() {
  var table = document.getElementById("salesreporttable");
  var startDate = document.getElementById("startDate_sales");
  var endDate = document.getElementById("endDate_sales");
  var submit = document.getElementById("summarySubmit_sales");

  submit.addEventListener("click", function () {
    var startDateValue = startDate.value;
    var endDateValue = endDate.value;

    if (table) {
      var rowCount = table.rows.length;

      // Delete existing rows except the header
      for (var i = rowCount - 1; i > 0; i--) {
        table.deleteRow(i);
      }
    }

    // Perform axios POST request
    axios.post("http://77.37.47.190:3059/getsalesreport", {
      username: username, // Assuming username is defined somewhere
      startdate: startDateValue,
      enddate: endDateValue,
    })
    .then((response) => {
      // Create a new row
      var tr = document.createElement("tr");

      // Create and populate cells with response data
      var playtd = document.createElement("td");
      playtd.innerHTML = response.data.played; // Access response data using response.data
      playtd.style.textAlign = "center"; // Center align content
      tr.appendChild(playtd);

      var wintd = document.createElement("td");
      wintd.innerHTML = response.data.win;
      wintd.style.textAlign = "center"; // Center align content
      tr.appendChild(wintd);

      var endtd = document.createElement("td");
      endtd.innerHTML = response.data.endamount;
      endtd.style.textAlign = "center"; // Center align content
      tr.appendChild(endtd);

      // Append the new row to the table
      table.appendChild(tr);
    })
    .catch((error) => {
      console.error("Error:", error);
    });
  });
}




function getDetailReportFromDate() {
  var table = document.getElementById("playDetailsTable");
  var currentDate = document.getElementById("reportDate");
  var buttonSelectorReport = document.getElementById("buttonSelectorReport");

  var submit = document.getElementById("reportSubmit");

  submit.addEventListener("click", function () {
    var dateValue = currentDate.value;
    var gameIDSelector = buttonSelectorReport.value;

    if (table) {
      var rowCount = table.rows.length;

      for (var i = rowCount - 1; i > 0; i--) {
        table.deleteRow(i);
      }
    }
    if (table) {
      var rowCount = table.rows.length;

      for (var i = rowCount - 1; i > 0; i--) {
        table.deleteRow(i);
      }
    }

    if (buttonSelectorReport.value === "all") {
      axios
        .post("http://77.37.47.190:3059/getreportbydate", {
          username: username,
          date: dateValue,
        })
        .then(function (response) {
          // console.log(response.data.data[0]);
          var responseData = response.data.data[0];
          responseData.forEach(function (game, index) {
            var tr = document.createElement("tr");

            // Serial No. (Index No.)
            var serialNo = document.createElement("td");
            var serialNoTextNode = document.createTextNode(index + 1);
            serialNo.appendChild(serialNoTextNode);
            tr.appendChild(serialNo);

            // Gift Event Code (GAMEID)
            var gameId = document.createElement("td");
            var gameIdTextNode = document.createTextNode(game.GAMEID);
            gameId.appendChild(gameIdTextNode);
            tr.appendChild(gameId);

            // Qty (TICKETTOTALRS[0])
            var qty = document.createElement("td");
            var qtyTextNode = document.createTextNode(game.TICKETTOTALRS[0]);
            qty.appendChild(qtyTextNode);
            tr.appendChild(qty);

            // Points (TICKETTOTALRS[1])
            var points = document.createElement("td");
            points.style.textAlign = "right";
            var pointsTextNode = document.createTextNode(game.TICKETTOTALRS[1]);
            points.appendChild(pointsTextNode);
            tr.appendChild(points);

            // Request ID (TICKETNUMBER)
            var requestId = document.createElement("td");
            requestId.id = "ticketNumber";
            var requestIdTextNode = document.createTextNode(game.TICKETNUMBER);
            requestId.appendChild(requestIdTextNode);
            tr.appendChild(requestId);

            // Date Time (GAMETIME)
            var utcTimestamp = game.GAMETIME;

            var dateObject = new Date(utcTimestamp);
            dateObject.setMinutes(dateObject.getMinutes() + 330);
            var year = dateObject.getFullYear();
            var month = String(dateObject.getMonth() + 1).padStart(2, "0"); // Month starts from 0
            var day = String(dateObject.getDate()).padStart(2, "0");
            var hours = String(dateObject.getHours()).padStart(2, "0");
            var minutes = String(dateObject.getMinutes()).padStart(2, "0");

            var formattedDateTime = utcTimestamp;//`${year}-${month}-${day} ${hours}:${minutes}`;

            var dateTime = document.createElement("td");
            var dateTimeTextNode = document.createTextNode(formattedDateTime);
            dateTime.appendChild(dateTimeTextNode);
            tr.appendChild(dateTime);

            // Gift Points (WINRS)
            var giftPoints = document.createElement("td");
            giftPoints.style.textAlign = "right";
            var giftPointsTextNode = document.createTextNode(game.WINRS);
            giftPoints.appendChild(giftPointsTextNode);
            tr.appendChild(giftPoints);

            // Stone (N/A)
            var stone = document.createElement("td");
            if (!game.GAMERESULT) {
              var stoneTextNode = document.createTextNode("N/A");
              stone.appendChild(stoneTextNode);
              tr.appendChild(stone);
            } else {
              var stoneTextNode = document.createTextNode(game.GAMERESULT);
              stone.appendChild(stoneTextNode);
              tr.appendChild(stone);
            }

            // Status (Active)
            var status = document.createElement("td");
            var statusTextNode = document.createTextNode("Active");
            status.appendChild(statusTextNode);
            tr.appendChild(status);

            // View
            var view = document.createElement("td");
            var viewLink = document.createElement("a");
            viewLink.href = "#"; // Add your view link here
            viewLink.setAttribute("onclick", "viewBarcodeByTicket(event)");
            viewLink.textContent = "View";
            view.appendChild(viewLink);
            tr.appendChild(view);

            table.appendChild(tr);
          });
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    } else {
      axios
        .post("http://77.37.47.190:3059/getreportbydateandid", {
          username: username.toString(),
          date: dateValue.toString(),
          gameid: gameIDSelector.toString(),
        })
        .then(function (response) {
          console.log(response.data);
          var responseData = response.data.data[0];
          responseData.forEach(function (game, index) {
            var tr = document.createElement("tr");

            // Serial No. (Index No.)
            var serialNo = document.createElement("td");
            var serialNoTextNode = document.createTextNode(index + 1);
            serialNo.appendChild(serialNoTextNode);
            tr.appendChild(serialNo);

            // Gift Event Code (GAMEID)
            var gameId = document.createElement("td");
            var gameIdTextNode = document.createTextNode(game.GAMEID);
            gameId.appendChild(gameIdTextNode);
            tr.appendChild(gameId);

            // Qty (TICKETTOTALRS[0])
            var qty = document.createElement("td");
            var qtyTextNode = document.createTextNode(game.TICKETTOTALRS[0]);
            qty.appendChild(qtyTextNode);
            tr.appendChild(qty);

            // Points (TICKETTOTALRS[1])
            var points = document.createElement("td");
            points.style.textAlign = "right";
            var pointsTextNode = document.createTextNode(game.TICKETTOTALRS[1]);
            points.appendChild(pointsTextNode);
            tr.appendChild(points);

            // Request ID (TICKETNUMBER)
            var requestId = document.createElement("td");
            requestId.id = "ticketNumber";
            var requestIdTextNode = document.createTextNode(game.TICKETNUMBER);
            requestId.appendChild(requestIdTextNode);
            tr.appendChild(requestId);

            // Date Time (GAMETIME)
            var utcTimestamp = game.GAMETIME;

            var dateObject = new Date(utcTimestamp);
            dateObject.setMinutes(dateObject.getMinutes() + 330);

            var year = dateObject.getFullYear();
            var month = String(dateObject.getMonth() + 1).padStart(2, "0"); // Month starts from 0
            var day = String(dateObject.getDate()).padStart(2, "0");
            var hours = String(dateObject.getHours()).padStart(2, "0");
            var minutes = String(dateObject.getMinutes()).padStart(2, "0");

            var formattedDateTime = utcTimestamp;//`${year}-${month}-${day} ${hours}:${minutes}`;

            var dateTime = document.createElement("td");
            var dateTimeTextNode = document.createTextNode(formattedDateTime);
            dateTime.appendChild(dateTimeTextNode);
            tr.appendChild(dateTime);

            // Gift Points (WINRS)
            var giftPoints = document.createElement("td");
            giftPoints.style.textAlign = "right";
            var giftPointsTextNode = document.createTextNode(game.WINRS);
            giftPoints.appendChild(giftPointsTextNode);
            tr.appendChild(giftPoints);

            // Stone (N/A)
            var stone = document.createElement("td");
            if (!game.GAMERESULT) {
              var stoneTextNode = document.createTextNode("N/A");
              stone.appendChild(stoneTextNode);
              tr.appendChild(stone);
            } else {
              var stoneTextNode = document.createTextNode(game.GAMERESULT);
              stone.appendChild(stoneTextNode);
              tr.appendChild(stone);
            }

            // Status (Active)
            var status = document.createElement("td");
            var statusTextNode = document.createTextNode("Active");
            status.appendChild(statusTextNode);
            tr.appendChild(status);

            // View
            var view = document.createElement("td");
            var viewLink = document.createElement("a");
            viewLink.href = "#"; // Add your view link here
            viewLink.setAttribute("onclick", "viewBarcodeByTicket(event)");
            viewLink.textContent = "View";
            view.appendChild(viewLink);
            tr.appendChild(view);

            table.appendChild(tr);
          });
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    }
  });
}

function viewBarcodeByTicket(event) {

  closeBarCodePopup();
  var reportPanel = document.querySelector(".barcodePopup");
  var viewButton = event.target;
  var ticketNumber = viewButton
    .closest("tr")
    .querySelector("#ticketNumber").textContent;
  reportPanel.style.display = "block";

  axios
    .post("http://77.37.47.190:3059/getticketbybarcode", {
      barcode: ticketNumber,
    })
    .then(function (response) {

      var responseData = response.data.data[0];

      var qtyPopupValue = 0;

      responseData.forEach(function (item) {
        var ticketGroup = document.querySelector(".barcodePopup .ticketGroup");
        var ticketDetailsArray = item.TICKETDETAILS.split(",");
        qtyPopupValue = (item["TICKETTOTALRS"]);
        ticketDetailsArray.forEach(function (ticketDetail) {


          if (parseInt(ticketDetail.substring(3)) !== 0) {
            var divElement = document.createElement("div");
            var pElement = document.createElement("p");
            pElement.classList.add("elementToClear");
            var ticketRaw = ticketDetail.trim();
            var abv = ticketDetail.substring(0, 2);
            var abvbv = "";


            let ticMD = "MD" + ticketDetail.substring(0, 2) + "*" + ticketDetail.substring(3);
            // let ticQ = ticketDetail
            var textNode = document.createTextNode(ticMD);

            qtyPopupValue = qtyPopupValue + 1;

            pElement.appendChild(textNode);
            divElement.appendChild(pElement);
            ticketGroup.appendChild(divElement);
          }
        });

        var dateTimePopup = document.getElementById("dateTimePopup");
        var dateSpan = document.createElement("span");
        dateSpan.id = "dateSpan";
        dateSpan.classList.add("elementToClear");
        dateSpan.innerHTML = item.GAMEDATE.slice(0, 10);
        dateTimePopup.append(dateSpan);

        var timeSpan = document.createElement("span");
        timeSpan.style.marginLeft = "5px";
        timeSpan.id = "timeSpan";
        timeSpan.classList.add("elementToClear");
        timeSpan.innerHTML = item.GAMETIME.slice(11, 19);
        dateTimePopup.append(timeSpan);

        var gameIdPopup = document.getElementById("gameIdPopup");
        gameIdPopup.innerHTML = item.GAMEID;

        var posIdPopup = document.getElementById("posIdPopup");
        posIdPopup.innerHTML = item.TARMINALID;

        var barCodePopupValue = document.getElementById("barCodePopupValue");
        barCodePopupValue.innerHTML = ticketNumber;

        var qtyPopup = document.getElementById("qtyPopup");
        qtyPopup.innerHTML = item["TICKETTOTALRS"];

        var totalPtsPopup = document.getElementById("totalPtsPopup");
        totalPtsPopup.innerHTML = item["TICKETTOTALRS"];

        JsBarcode("#barcodeEle", `${ticketNumber}`, {
          fontSize: 28,
          height: 60,
        });

        // console.log(item.TICKETDETAILS);
      });
    });
}

document.addEventListener("DOMContentLoaded", function () {
  getReportFromDate();
  getSalesreport();
  getDetailReportFromDate();
});

function closeBarCodePopup() {
  var reportPanel = document.querySelector(".barcodePopup");

  var elementsToClear = document.querySelectorAll(".elementToClear");
  elementsToClear.forEach(function (element) {
    element.innerHTML = "";
  });

  reportPanel.style.display = "none";
}

function createOptions(array) {
  let options = "";
  array.forEach((item) => {
    let option = document.createElement("option");
    option.value = item;
    option.textContent = item;
    selectElement.appendChild(option);
  });
  return options;
}

const alpha = [
  "A",
  "B",
  "C",
  "D",
  "E",
  "F",
  "G",
  "H",
  "I",
  "J",
  "K",
  "L",
  "M",
  "N",
];
let betentryarray = [];

for (let x = 0; x < alpha.length; x++) {
  for (let y = 0; y < 12; y++) {
    let entry = y < 10 ? `${alpha[x]}0${y}` : `${alpha[x]}${y}`;
    betentryarray.push(entry);
  }
}

console.log(betentryarray);

// Now, let's create options for each item in the betentryarray
const selectElement = document.getElementById("buttonSelectorReport");
createOptions(betentryarray, selectElement);

function countTotal() {
  var totalQty = document.querySelectorAll("");
  var a = 0;
  totalQty.forEach((item) => {
    a = a + item.textContent;
  });
}



// Page Idle Script 
let timea = new Date().getTime();

const setActivityTime = () => {
  timea = new Date().getTime();
};

document.body.addEventListener("touchstart", setActivityTime);
document.body.addEventListener("touchmove", setActivityTime);
document.body.addEventListener("touchend", setActivityTime);
document.body.addEventListener("mousedown", setActivityTime);
document.body.addEventListener("mousemove", setActivityTime);
document.body.addEventListener("keypress", setActivityTime);

const refresh = () => {
  if (new Date().getTime() - timea >= 7 * 60000) {
    alert("session time out")
    window.location.reload(true);
  } else {
    setTimeout(refresh, 1);
  }
};

//setTimeout(refresh, 1);

// USE THIS FUNCTION IN CASE OF FIREFOX

function checkBrowser() {
   var isFirefox = typeof InstallTrigger !== 'undefined';
  if (!isFirefox) {
    document.body.innerHTML = "<h1>Access Denied. Use Firefox.</h1>";
  }
}
checkBrowser();


function resetPage() {
  // Perform actions to reset the page here
  // For example, reload the page

 
  gameId=null;
  time=null;
 
  getAllResultsSoFar();

    gettimeandgameid();

   console.log("reseting time and id ");
}

// Event listener for when the window loses focus
window.addEventListener('blur', function() {
  // Call the resetPage function when the window loses focus
  resetPage();
});
console.log(`welcome to mgdelux_webversion 1.01 this update fixes include
-advance bet not placing bet for more than 1 advance bet 
-bet input sending 0 values 
-timer not reseting when the app is paused
-change password will remain if username password is same
-added bug fix for when newpassword and retype new password are not same wtf ridz ;c
-fixed advance bet not reseting on time end XDDDDD
-fixed cancel bet
-added current date to all date fields`)

</script>
<script>
  function setToday() {
  // Get today's date in the format "YYYY-MM-DD"
  var today = new Date().toISOString().split('T')[0];
  
  // Set today's date to each date input field
  var dateInputs = document.querySelectorAll('input[type="date"]');
  dateInputs.forEach(function(input) {
    input.value = today;
  });
}
setToday();
  document.getElementById("catchpa").innerHTML =
    Math.floor(Math.random() * (999999 - 300000 + 1)) + 300000;
  const today = new Date().toISOString().split("T")[0];

  // Set the default value of the input to today
  document.getElementById("date").value = today;
  showresultbydate();
  function hideblock() {
    document.getElementById("advancebet_show").style = "display:none";
  }
</script>

</html>